<!doctype html>
<html class="no-js" lang="{{ shop.locale }}">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <!-- Progressive Enhancement: Remove no-js class as early as possible -->
    <script>
      document.documentElement.classList.remove('no-js');
    </script>

    <!-- ZusÃ¤tzliche Metadaten, Stylesheets -->
    {% render 'root-theme' %}

    <!-- Performance: Resource hints for faster asset loading -->
    <link rel="preconnect" href="https://cdn.shopify.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.shopify.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    {% if shop.domain contains 'myshopify.com' %}
      <link rel="preconnect" href="https://{{ shop.domain }}" crossorigin>
      <link rel="dns-prefetch" href="https://{{ shop.domain }}">
    {% endif %}

    <title>
      {% if page_title %}{{ page_title }} - {% endif %}
      {{ shop.name }}
    </title>

    {{ content_for_header }}

    <!-- Google Font Einbindung -->
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet">

    <!-- Preload Skripte -->
    {% if settings.enable_judgeme %}
      <script src="https://cdn.judge.me/widget/shopify/installed.js" defer></script>
    {% endif %}

    <!-- Global Theme Bundle -->
    {% if shop.domain contains 'myshopify.com'
      or request.host contains '127.0.0.1'
      or request.host contains 'localhost'
    %}
      <!-- Development: Add timestamp for cache-busting - use request time for consistency -->
      {% assign cache_buster = 'now' | date: '%s' %}
      {% assign theme_css_url = 'global.css' | asset_url | append: '?v=' | append: cache_buster | append: '&t=' | append: request.requested_at %}
      <link rel="stylesheet" href="{{ theme_css_url }}" media="all">
    {% else %}
      {{ 'global.css' | asset_url | stylesheet_tag }}
    {% endif %}

    <!-- Shared Features Bundle (includes notifications, dropdowns, product cards, etc.) -->
    {% if shop.domain contains 'myshopify.com'
      or request.host contains '127.0.0.1'
      or request.host contains 'localhost'
    %}
      {% assign features_css_url = 'features-shared-all.css' | asset_url | append: '?v=' | append: cache_buster | append: '&t=' | append: request.requested_at %}
      <link rel="stylesheet" href="{{ features_css_url }}" media="all">
    {% else %}
      {{ 'features-shared-all.css' | asset_url | stylesheet_tag }}
    {% endif %}

    <!-- Conditional Section Assets -->
    {% render 'snippet-theme-conditional-section-styles' %}
  </head>
  <body class="{{ template | replace: '/', '-' }}">
    <!-- Header Content -->
    <div id="HeaderContent" class="content-for-header">
      {% sections 'header-group' %}
    </div>
    {% sections 'drawer-group' %}
    <!-- Hauptinhalt -->
    <main id="MainContent" class="content-for-layout" role="main" tabindex="-1">
      {{ content_for_layout }}
    </main>
    <!-- Footer Content -->
    {% sections 'footer-group' %}

    <!-- Initialize features -->
    {%- if request.page_type == 'product' -%}
      {% render 'snippet-utils-product-variants', product: product %}
    {%- endif -%}
    {% render 'snippet-utils-logger' %}
    {% render 'snippet-feature-notification', product: product %}

    <!-- Global Theme Bundle JavaScript -->
    {% if shop.domain contains 'myshopify.com'
      or request.host contains '127.0.0.1'
      or request.host contains 'localhost'
    %}
      <script src="{{ 'global.js' | asset_url | append: '?v=' | append: cache_buster }}" defer></script>
    {% else %}
      <script src="{{ 'global.js' | asset_url }}" defer></script>
    {% endif %}

    <!-- Shared Features Bundle JavaScript -->
    {% if shop.domain contains 'myshopify.com'
      or request.host contains '127.0.0.1'
      or request.host contains 'localhost'
    %}
      <script src="{{ 'features-shared-all.js' | asset_url | append: '?v=' | append: cache_buster }}" defer></script>
    {% else %}
      <script src="{{ 'features-shared-all.js' | asset_url }}" defer></script>
    {% endif %}

    <!-- Conditional Section Scripts (load after dependencies) -->
    {% render 'snippet-theme-conditional-section-scripts' %}
  </body>
</html>
