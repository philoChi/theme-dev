{% comment %}
  Image Menu Section
  Displays a customizable horizontal menu with circular images and labels.
  Features accessibility support, responsive design, and performance optimization.
  Supports up to 6 items with automatic responsive hiding on smaller screens.
{% endcomment %}
{%- comment -%} Assets loaded conditionally via theme.liquid {%- endcomment -%}

{%- liquid
  assign max_items = section.settings.max_items | default: 6
  assign section_id = 'image-menu-' | append: section.id
-%}

<section 
  class="image-menu" 
  id="{{ section_id }}"
  role="navigation"
  aria-label="{{ 'section-specific.image-menu.sections.navigation_label' | t }}"
>
  <div class="image-menu__container">
    {% for block in section.blocks limit: max_items %}
      {%- liquid
        assign item_label = block.settings.label | default: 'section-specific.image-menu.sections.default_label'
        assign item_link = block.settings.link
        assign has_image = false
        if block.settings.image != blank
          assign has_image = true
        endif
      -%}
      
      <a 
        href="{{ item_link }}" 
        class="image-menu__item"
        aria-label="{{ item_label | escape }}"
        {{ block.shopify_attributes }}
      >
        <div class="image-menu__item-image-container">
          {% if has_image %}
            <img
              src="{{ block.settings.image | image_url: width: 150 }}"
              srcset="{{ block.settings.image | image_url: width: 75 }} 75w,
                      {{ block.settings.image | image_url: width: 150 }} 150w,
                      {{ block.settings.image | image_url: width: 200 }} 200w"
              sizes="(max-width: 479px) 50px, (max-width: 767px) 50px, (max-width: 991px) 65px, 75px"
              width="75"
              height="75"
              alt="{{ item_label | escape }}"
              loading="lazy"
              class="image-menu__item-image"
            >
          {% else %}
            {%- comment -%} Placeholder for missing images {%- endcomment -%}
            <div class="image-menu__item-image image-menu__item-image--placeholder" aria-hidden="true"></div>
          {% endif %}
        </div>
        
        <span class="image-menu__item-label">
          {{ item_label }}
        </span>
      </a>
    {% endfor %}
  </div>
</section>

{% schema %}
{
  "name": {
    "en": "Image Menu",
    "de": "Bild-Menü"
  },
  "tag": "section",
  "class": "image-menu-section",
  "settings": [
    {
      "type": "header",
      "content": {
        "en": "Display Settings",
        "de": "Anzeigeeinstellungen"
      }
    },
    {
      "type": "range",
      "id": "max_items",
      "label": {
        "en": "Maximum items to display",
        "de": "Maximale Anzahl der anzuzeigenden Elemente"
      },
      "info": {
        "en": "Items automatically hide on smaller screens for better mobile experience",
        "de": "Elemente werden auf kleineren Bildschirmen automatisch ausgeblendet für bessere mobile Erfahrung"
      },
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 6
    }
  ],
  "blocks": [
    {
      "type": "menu_item",
      "name": {
        "en": "Menu Item",
        "de": "Menü-Element"
      },
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": {
            "en": "Image",
            "de": "Bild"
          },
          "info": {
            "en": "Recommended: Square image, minimum 150x150px",
            "de": "Empfohlen: Quadratisches Bild, mindestens 150x150px"
          }
        },
        {
          "type": "text",
          "id": "label",
          "label": {
            "en": "Label",
            "de": "Bezeichnung"
          },
          "placeholder": {
            "en": "Menu item name",
            "de": "Name des Menü-Elements"
          }
        },
        {
          "type": "url",
          "id": "link",
          "label": {
            "en": "Link",
            "de": "Link"
          },
          "info": {
            "en": "Where should this item link to?",
            "de": "Wohin soll dieses Element verlinken?"
          }
        }
      ],
      "limit": 6
    }
  ],
  "presets": [
    {
      "name": {
        "en": "Image Menu",
        "de": "Bild-Menü"
      },
      "blocks": [
        {
          "type": "menu_item",
          "settings": {
            "label": "Shop All"
          }
        },
        {
          "type": "menu_item",
          "settings": {
            "label": "New Arrivals"
          }
        },
        {
          "type": "menu_item",
          "settings": {
            "label": "Sale"
          }
        }
      ]
    }
  ]
}
{% endschema %}
