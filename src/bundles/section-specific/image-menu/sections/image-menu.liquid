{% comment %}
  Image Menu Section
  Displays a customizable horizontal menu with circular images and labels.
  Features accessibility support, responsive design, and performance optimization.
  Supports up to 6 items with automatic responsive hiding on smaller screens.
{% endcomment %}
{%- comment -%} Assets loaded conditionally via theme.liquid {%- endcomment -%}

{%- liquid
  assign section_id = 'image-menu-' | append: section.id
  assign border_position = section.settings.border_position | default: 'top'
  assign background_enabled = section.settings.background_enabled | default: true
  assign use_default_background = section.settings.use_default_background | default: true
  assign custom_background_color = section.settings.background_color
  
  # Build CSS classes for border position
  assign border_class = 'image-menu--border-' | append: border_position
  
  # Build background style
  assign background_style = ''
  unless background_enabled
    assign background_style = 'background-color: transparent;'
  else
    unless use_default_background
      if custom_background_color != blank
        assign background_style = 'background-color: ' | append: custom_background_color | append: ';'
      endif
    endunless
  endunless
-%}

<section 
  class="image-menu {{ border_class }}" 
  id="{{ section_id }}"
  role="navigation"
  aria-label="{{ 'section-specific.image-menu.sections.navigation_label' | t }}"
  {% if background_style != blank %}style="{{ background_style }}"{% endif %}
>
  <div class="image-menu__container">
    {% for block in section.blocks %}
      {%- liquid
        assign item_label = block.settings.label | default: 'section-specific.image-menu.sections.default_label'
        assign item_link = block.settings.link
      -%}
      
      {% render 'snippet-feature-image-link', 
         image: block.settings.image,
         label: item_label,
         link: item_link,
         class_modifier: 'menu',
         loading: 'lazy',
         shopify_attributes: block.shopify_attributes
      %}
    {% endfor %}
  </div>
</section>

{% schema %}
{
  "name": {
    "en": "Image Menu",
    "de": "Bild-Menü"
  },
  "tag": "section",
  "class": "image-menu-section",
  "settings": [
    {
      "type": "header",
      "content": {
        "en": "Border Settings",
        "de": "Rahmeneinstellungen"
      }
    },
    {
      "type": "select",
      "id": "border_position",
      "label": {
        "en": "Border Position",
        "de": "Rahmenposition"
      },
      "info": {
        "en": "Choose where to display the border around the image menu",
        "de": "Wählen Sie, wo der Rahmen um das Bildmenü angezeigt werden soll"
      },
      "options": [
        {
          "value": "none",
          "label": {
            "en": "No Border",
            "de": "Kein Rahmen"
          }
        },
        {
          "value": "top",
          "label": {
            "en": "Top Border",
            "de": "Oberer Rahmen"
          }
        },
        {
          "value": "bottom",
          "label": {
            "en": "Bottom Border",
            "de": "Unterer Rahmen"
          }
        },
        {
          "value": "both",
          "label": {
            "en": "Top and Bottom Border",
            "de": "Oberer und unterer Rahmen"
          }
        }
      ],
      "default": "top"
    },
    {
      "type": "header",
      "content": {
        "en": "Background Settings",
        "de": "Hintergrundeinstellungen"
      }
    },
    {
      "type": "checkbox",
      "id": "background_enabled",
      "label": {
        "en": "Enable Background",
        "de": "Hintergrund aktivieren"
      },
      "info": {
        "en": "When disabled, the background will be transparent",
        "de": "Bei Deaktivierung ist der Hintergrund transparent"
      },
      "default": true
    },
    {
      "type": "checkbox",
      "id": "use_default_background",
      "label": {
        "en": "Use Default Background Color",
        "de": "Standard-Hintergrundfarbe verwenden"
      },
      "info": {
        "en": "Use the theme's main background color, or choose a custom color below",
        "de": "Verwenden Sie die Haupt-Hintergrundfarbe des Themes oder wählen Sie unten eine benutzerdefinierte Farbe"
      },
      "default": true
    },
    {
      "type": "color",
      "id": "background_color",
      "label": {
        "en": "Custom Background Color",
        "de": "Benutzerdefinierte Hintergrundfarbe"
      },
      "info": {
        "en": "Only used when 'Use Default Background Color' is disabled",
        "de": "Wird nur verwendet, wenn 'Standard-Hintergrundfarbe verwenden' deaktiviert ist"
      }
    }
  ],
  "blocks": [
    {
      "type": "menu_item",
      "name": {
        "en": "Menu Item",
        "de": "Menü-Element"
      },
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": {
            "en": "Image",
            "de": "Bild"
          },
          "info": {
            "en": "Recommended: Square image, minimum 480x480px for crisp display",
            "de": "Empfohlen: Quadratisches Bild, mindestens 480x480px für scharfe Darstellung"
          }
        },
        {
          "type": "text",
          "id": "label",
          "label": {
            "en": "Label",
            "de": "Bezeichnung"
          },
          "placeholder": {
            "en": "Menu item name",
            "de": "Name des Menü-Elements"
          }
        },
        {
          "type": "url",
          "id": "link",
          "label": {
            "en": "Link",
            "de": "Link"
          },
          "info": {
            "en": "Where should this item link to?",
            "de": "Wohin soll dieses Element verlinken?"
          }
        }
      ],
      "limit": 6
    }
  ],
  "presets": [
    {
      "name": {
        "en": "Image Menu",
        "de": "Bild-Menü"
      },
      "blocks": [
        {
          "type": "menu_item",
          "settings": {
            "label": "Shop All"
          }
        },
        {
          "type": "menu_item",
          "settings": {
            "label": "New Arrivals"
          }
        },
        {
          "type": "menu_item",
          "settings": {
            "label": "Sale"
          }
        }
      ]
    }
  ]
}
{% endschema %}
