{%- liquid
  assign slider_id = section.id | default: 'image-slider-default'
  assign slider_blocks_count = section.blocks.size | default: 0
  assign current_slide_index = section.settings.current_slide | default: 1
  assign slide_gap_percent = section.settings.slide_gap | default: 5
  assign gap_multiplier = slide_gap_percent | divided_by: 100.0 | plus: 1.0
  assign current_slide_position = current_slide_index | times: gap_multiplier
  
  assign first_slide = section.blocks.first
  if first_slide and first_slide.settings.image != blank
    echo first_slide.settings.image | image_url: width: 1920 | preload_tag: as: 'image', media: '(min-width: 768px)'
    echo first_slide.settings.image | image_url: width: 768 | preload_tag: as: 'image', media: '(max-width: 767px)'
  endif
-%}

<section
  id="{{ slider_id }}"
  class="image-slider"
  role="region"
  aria-label="Image carousel with {{ slider_blocks_count }} slides"
  data-section-type="image-slider"
  style="
    --slider-transition-duration: {{ section.settings.transition_duration | default: 1000 }}ms;
    --slider-slide-spacing: {{ section.settings.slide_gap | default: 5 }}%;
    --slider-section-padding: {{ section.settings.section_padding | default: 32 }}px;
    --slider-slide-blur: {{ section.settings.blur_amount | default: 4 }}px;
    --slider-slide-opacity: {{ section.settings.side_opacity | default: 0.6 }};
    --slider-slide-scale: {{ section.settings.side_scale | default: 0.8 }};
    --slider-slide-count: {{ slider_blocks_count }};
    --slider-current-position: {{ current_slide_index }};
    {%- if section.settings.background_image != blank -%}
      --slider-background-image: url({{ section.settings.background_image | image_url: width: 800 }});
      --slider-background-opacity: {{ section.settings.background_opacity | default: 0.1 }};
      --slider-background-tile-size: {{ section.settings.background_tile_size | default: 150 }}px;
    {%- endif -%}
  "
>
  <div class="image-slider__wrapper">
    <div class="image-slider__container" 
         style="transform: translateX(calc(50vw - var(--slider-slide-total-max-width) * ({{ current_slide_position }} + 0.5)))">
    {%- for block in section.blocks -%}
      {%- render 'snippet-section-image-slider-slide', 
        block: block,
        slider_id: slider_id,
        slide_index: forloop.index,
        slide_length: forloop.length,
        current_slide_index: current_slide_index
      -%}
    {%- endfor -%}
    </div>
    {%- render 'snippet-section-image-slider-navigation', 
      slider_id: slider_id, 
      blocks_count: slider_blocks_count
    -%}
  </div>
</section>

{% schema %}
{
  "name": "Image Slider",
  "tag": "section",
  "class": "shopify-section--slider",
  "max_blocks": 10,
  "settings": [
    {
      "type": "header",
      "content": "Slider Behavior"
    },
    {
      "type": "range",
      "id": "transition_duration",
      "label": "Transition duration (ms)",
      "min": 100,
      "max": 3000,
      "step": 50,
      "default": 1000
    },

    /* --------  Appearance group  -------- */
    {
      "type": "header",
      "content": "Appearance"
    },
    {
      "type": "range",
      "id": "slide_gap",
      "label": "Gap between slides (%)",
      "min": 2,
      "max": 15,
      "step": 1,
      "default": 5
    },
    {
      "type": "range",
      "id": "section_padding",
      "label": "Padding above & below slider (px)",
      "min": 0,
      "max": 160,
      "step": 4,
      "default": 32
    },
    {
      "type": "range",
      "id": "blur_amount",
      "label": "Side‑slide blur (px)",
      "min": 0,
      "max": 20,
      "step": 1,
      "default": 4
    },
    {
      "type": "range",
      "id": "side_opacity",
      "label": "Side‑slide opacity (0 – 1)",
      "min": 0.1,
      "max": 1,
      "step": 0.1,
      "default": 0.6
    },
    {
      "type": "range",
      "id": "side_scale",
      "label": "Side‑slide scale (0.5 – 1)",
      "min": 0.5,
      "max": 1,
      "step": 0.1,
      "default": 0.8
    },
    /* ---------- Background ---------- */
    {
      "type": "header",
      "content": "Background Pattern"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background tile image"
    },
    {
      "type": "range",
      "id": "background_opacity",
      "label": "Background opacity",
      "min": 0,
      "max": 1,
      "step": 0.1,
      "default": 0.1
    },
    {
      "type": "range",
      "id": "background_tile_size",
      "label": "Background tile size (px)",
      "min": 50,
      "max": 500,
      "step": 10,
      "default": 150
    },
    /* ---------- Navigation ---------- */
    {
      "type": "header",
      "content": "Navigation Positioning"
    },
    {
      "type": "range",
      "id": "navigation_left_distance",
      "label": "Left distance (%)",
      "min": 0,
      "max": 25,
      "step": 1,
      "default": 10
    },
    {
      "type": "range",
      "id": "navigation_right_distance", 
      "label": "Right distance (%)",
      "min": 0,
      "max": 25,
      "step": 1,
      "default": 10
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Slide Image" },
        { "type": "text", "id": "title", "label": "Slide Title", "default": "New Slide" },
        {
          "type": "textarea",
          "id": "description",
          "label": "Slide Description",
          "default": "Describe your promotion here"
        },
        { "type": "header", "content": "CTA Buttons" },
        { "type": "text", "id": "cta_text_1", "label": "CTA 1 Text" },
        { "type": "url", "id": "cta_link_1", "label": "CTA 1 Link" },
        { "type": "color", "id": "cta_color_1", "label": "CTA 1 Color", "default": "#000000" },
        { "type": "text", "id": "cta_text_2", "label": "CTA 2 Text" },
        { "type": "url", "id": "cta_link_2", "label": "CTA 2 Link" },
        { "type": "color", "id": "cta_color_2", "label": "CTA 2 Color", "default": "#000000" },
        { "type": "text", "id": "cta_text_3", "label": "CTA 3 Text" },
        { "type": "url", "id": "cta_link_3", "label": "CTA 3 Link" },
        { "type": "color", "id": "cta_color_3", "label": "CTA 3 Color", "default": "#000000" }
      ]
    }
  ]
}
{% endschema %}
