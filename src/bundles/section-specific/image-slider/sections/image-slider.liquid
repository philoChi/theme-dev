{% comment %} sections/slider-section.liquid – updated for configurable gaps, side‑effects & optional BG pattern {% endcomment %}

{%- comment -%} Assets loaded conditionally via theme.liquid {%- endcomment -%}

{%- liquid
  assign slide_gap = section.settings.slide_gap | default: 16
  assign section_padding = section.settings.section_padding | default: 32
  assign blur_amount = section.settings.blur_amount | default: 4
  assign side_opacity = section.settings.side_opacity | default: 0.6
  assign side_scale = section.settings.side_scale | default: 0.8
  assign bg_img = section.settings.background_image
  assign bg_opacity = section.settings.background_opacity | default: 0
  assign bg_size = section.settings.background_tile_size | default: 150
-%}

<section
  class="slider-section"
  aria-label="Image slider"
  data-section-type="slider-section"
  data-autoplay="{{ section.settings.enable_autoplay }}"
  data-interval="{{ section.settings.autoplay_interval | times: 1000 }}"
  style="
    --transition-duration: {{ section.settings.transition_duration }}ms;
    --slide-gap: {{ slide_gap }}px;
    --section-padding: {{ section_padding }}px;
    --blur-amount: {{ blur_amount }}px;
    --slide-opa: {{ side_opacity }};
    --slide-scale: {{ side_scale }};
    {%- if bg_img != blank -%}
      --slider-bg: url({{ bg_img | image_url: width: 200 }});
      --slider-bg-opa: {{ bg_opacity }};
      --slider-bg-size: {{ bg_size }}px;
    {%- endif -%}
  "
>
  <div class="slider-arrows">
    {%- render 'snippet-feature-arrow-navigation',
      data_attributes: 'data-arrow="prev"',
      direction: 'prev',
      style_wrapper: 'glassmorphism',
      position: 'overlay'
    -%}
    {%- render 'snippet-feature-arrow-navigation',
      data_attributes: 'data-arrow="next"',
      direction: 'next',
      style_wrapper: 'glassmorphism',
      position: 'overlay'
    -%}
  </div>

  <div class="slider-container" style="opacity: 0; transition: opacity 0.3s ease;">
    {% for block in section.blocks %}
      {% comment %} Render each slide {% endcomment %}
      <div class="slider-slide{% if forloop.first %} active{% endif %}" {{ block.shopify_attributes }}>
        {% if block.settings.image %}
          {{
            block.settings.image
            | image_url: width: 1500
            | image_tag: loading: 'lazy', widths: '300, 600, 900, 1200, 1500', class: 'slide-image'
          }}
        {% else %}
          <div class="placeholder-slide">
            {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
          </div>
        {% endif %}
        {% render 'snippet-section-image-slider-slide', block: block %}
      </div>
    {% endfor %}
  </div>
</section>

{%- comment -%} JavaScript loaded conditionally via theme.liquid {%- endcomment -%}

{% schema %}
{
  "name": "Image Slider",
  "tag": "section",
  "class": "shopify-section--slider",
  "max_blocks": 10,
  "settings": [
    {
      "type": "header",
      "content": "Slider Behavior"
    },
    {
      "type": "checkbox",
      "id": "enable_autoplay",
      "label": "Enable autoplay",
      "default": false
    },
    {
      "type": "range",
      "id": "autoplay_interval",
      "label": "Autoplay interval (seconds)",
      "min": 4,
      "max": 20,
      "step": 1,
      "default": 10
    },
    {
      "type": "range",
      "id": "transition_duration",
      "label": "Transition duration (ms)",
      "min": 100,
      "max": 3000,
      "step": 50,
      "default": 1000
    },

    /* --------  New Appearance group  -------- */
    {
      "type": "header",
      "content": "Appearance"
    },
    {
      "type": "range",
      "id": "slide_gap",
      "label": "Gap between slides (px)",
      "min": 0,
      "max": 64,
      "step": 2,
      "default": 16
    },
    {
      "type": "range",
      "id": "section_padding",
      "label": "Padding above & below slider (px)",
      "min": 0,
      "max": 160,
      "step": 4,
      "default": 32
    },
    {
      "type": "range",
      "id": "blur_amount",
      "label": "Side‑slide blur (px)",
      "min": 0,
      "max": 20,
      "step": 1,
      "default": 4
    },
    {
      "type": "range",
      "id": "side_opacity",
      "label": "Side‑slide opacity (0 – 1)",
      "min": 0.1,
      "max": 1,
      "step": 0.1,
      "default": 0.6
    },
    {
      "type": "range",
      "id": "side_scale",
      "label": "Side‑slide scale (0.5 – 1)",
      "min": 0.5,
      "max": 1,
      "step": 0.1,
      "default": 0.8
    },
    /* ---------- Background ---------- */
    {
      "type": "header",
      "content": "Background Pattern"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background tile image"
    },
    {
      "type": "range",
      "id": "background_opacity",
      "label": "Background opacity",
      "min": 0,
      "max": 1,
      "step": 0.1,
      "default": 0.1
    },
    {
      "type": "range",
      "id": "background_tile_size",
      "label": "Background tile size (px)",
      "min": 50,
      "max": 500,
      "step": 10,
      "default": 150
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Slide Image" },
        { "type": "text", "id": "title", "label": "Slide Title", "default": "New Slide" },
        {
          "type": "textarea",
          "id": "description",
          "label": "Slide Description",
          "default": "Describe your promotion here"
        },
        { "type": "header", "content": "CTA Buttons" },
        { "type": "text", "id": "cta_text_1", "label": "CTA 1 Text" },
        { "type": "url", "id": "cta_link_1", "label": "CTA 1 Link" },
        { "type": "color", "id": "cta_color_1", "label": "CTA 1 Color", "default": "#000000" },
        { "type": "text", "id": "cta_text_2", "label": "CTA 2 Text" },
        { "type": "url", "id": "cta_link_2", "label": "CTA 2 Link" },
        { "type": "color", "id": "cta_color_2", "label": "CTA 2 Color", "default": "#000000" },
        { "type": "text", "id": "cta_text_3", "label": "CTA 3 Text" },
        { "type": "url", "id": "cta_link_3", "label": "CTA 3 Link" },
        { "type": "color", "id": "cta_color_3", "label": "CTA 3 Color", "default": "#000000" }
      ]
    }
  ]
}
{% endschema %}
