{%- liquid
  # Debug output for implementation verification
  if request.design_mode
    echo '<!-- [FAQ Section] Initializing with ' | append: section.blocks.size | append: ' FAQs -->'
  endif
-%}

<faq-section
  class="faq-section"
  data-single-dropdown="{{ section.settings.single_dropdown }}"
  data-enable-direct-links="{{ section.settings.enable_direct_links }}"
  data-i18n-no-results="{{ 'sections.faq.no_results' | t }}"
  data-i18n-results-one="{{ 'sections.faq.results_count.one' | t }}"
  data-i18n-results-other="{{ 'sections.faq.results_count.other' | t }}"
>
  <div class="faq-container content-padding">
    {%- if section.settings.show_search -%}
      <div class="faq-section__search" data-faq-search>
        {%- liquid
          assign search_placeholder_text = 'sections.faq.search_placeholder' | t
        -%}
        {%- render 'snippet-section-page-faq-search-box',
          placeholder: search_placeholder_text,
          aria_label: search_placeholder_text,
          component_class: 'faq-search-box',
          search_data_attr: 'data-faq-search-input',
          results_data_attr: 'data-faq-search-results'
        -%}
      </div>
    {%- endif -%}

    <div class="faq-section__content" data-faq-content>
      {%- if section.blocks.size > 0 -%}
        <div class="faq-section__list" data-faq-list>
          {%- for block in section.blocks -%}
            {%- if block.type == 'faq' -%}
              <div
                class="faq-section__item"
                data-faq-item
                id="question-{{ forloop.index }}"
                {{ block.shopify_attributes }}
              >
                {%- assign faq_panel_id = 'faq-' | append: forloop.index -%}
                {%- render 'snippet-feature-dropdown',
                  trigger_text: block.settings.question,
                  panel_content: block.settings.answer,
                  panel_id: faq_panel_id,
                  wrapper_class: 'faq-dropdown'
                -%}
              </div>
            {%- endif -%}
          {%- endfor -%}
        </div>
      {%- else -%}
        <div class="faq-section__empty">
          <p>{{ 'sections.faq.no_faqs' | t }}</p>
        </div>
      {%- endif -%}
    </div>
  </div>
</faq-section>

{%- if request.design_mode -%}
  <script>
    console.log('[FAQ Section] Rendered with:', {
      faqCount: {{ section.blocks.size }},
      searchEnabled: {{ section.settings.show_search | json }},
      directLinksEnabled: {{ section.settings.enable_direct_links | json }}
    });
  </script>
{%- endif -%}

{% schema %}
{
  "name": "FAQ Page",
  "tag": "section",
  "class": "section-faq-page",
  "settings": [
    {
      "type": "text",
      "id": "page_title",
      "label": "Page Title",
      "default": "HÃ¤ufig gestellte Fragen"
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "label": "Show Search Box",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_direct_links",
      "label": "Enable Direct Links to FAQs",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "single_dropdown",
      "label": "Only One FAQ Open at a Time",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "faq",
      "name": "FAQ",
      "settings": [
        {
          "type": "text",
          "id": "question",
          "label": "Question",
          "default": "What is your return policy?"
        },
        {
          "type": "richtext",
          "id": "answer",
          "label": "Answer",
          "default": "<p>We offer a 30-day return policy for all items in their original condition.</p>"
        }
      ]
    }
  ],
  "max_blocks": 50,
  "presets": [
    {
      "name": "FAQ Page",
      "blocks": [
        {
          "type": "faq",
          "settings": {
            "question": "What is your return policy?",
            "answer": "<p>We offer a 30-day return policy for all items in their original condition.</p>"
          }
        },
        {
          "type": "faq",
          "settings": {
            "question": "How long does shipping take?",
            "answer": "<p>Standard shipping takes 3-5 business days. Express shipping is available for 1-2 day delivery.</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}
