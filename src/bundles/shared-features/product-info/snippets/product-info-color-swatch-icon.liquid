{%- comment -%}
  ----------------------------------------------------------------
  Snippet:  color‑swatch.liquid
  Params:
    • value              – the option value object or string
    • variant_for_color  – variant representing this colour (interactive only)
    • current_variant    – currently selected variant (interactive only)
    • static / mode      – truthy → render **static** swatch
  ----------------------------------------------------------------
{%- endcomment -%}

{%- assign is_static = static | default: false -%}
{%- if mode == 'static' or mode == 'simple' -%}{% assign is_static = true %}{% endif -%}

{%- comment -%} ─── Derive swatch colour ─────────────────────── {%- endcomment -%}
{%- capture swatch_color -%}
    {%- if value.swatch and value.swatch.color -%}
        rgb({{ value.swatch.color.rgb }})
    {%- elsif value contains '#' or value contains 'rgb(' -%}
        {{ value }}
    {%- else -%}
        {{ value | color_to_rgb | prepend: 'rgb(' | append: ')' }}
    {%- endif -%}
{%- endcapture -%}

{%- if is_static -%}
  <span class="color-swatch--static"
        style="--swatch-color: {{ swatch_color }};"
        aria-label="{{ value | escape }}">
  </span>
{%- else -%}
  <button type="button"
          class="color-swatch{% if variant_for_color.id == current_variant.id %} is-selected{% endif %}"
          style="--swatch-color: {{ swatch_color }};"
          data-variant-id="{{ variant_for_color.id }}"
          {% if variant_for_color.featured_media %}
            data-media-id="{{ variant_for_color.featured_media.id }}"
            data-media-url="{{ variant_for_color.featured_media | image_url: width: 400 }}"
          {% endif %}
          data-price="{{ variant_for_color.price | money }}"
          data-compare-price="{{ variant_for_color.compare_at_price | money | escape }}"
          data-show-compare="{{ variant_show_compare }}"
          data-sale-percentage="{{ variant_sale_percentage }}"
          aria-label="{{ 'shared-features.product-info.select_color' | t: color: value }}"
          {% if variant_for_color.id == current_variant.id %}aria-current="true"{% endif %}>
  </button>
{%- endif -%}